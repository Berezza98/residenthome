<div id="sidebar" class="sidebar prod-page--info product-block-list__item product-block-list__item--info1">
  {%- assign selected_variant = product.selected_or_first_available_variant -%}


  <div class="sidebar__inner card {% if product.media.size > 0 %}card--collapsed{% endif %} {% if template.name == 'product' %}card--sticky1{% endif %}">
    {%- if section.settings.enable_image_zoom -%}
      <div id="product-zoom-{{ section.id }}" class="product__zoom-wrapper"></div>
    {%- endif -%}

    <div class="card__section">
      {% comment %}
      ------------------------------------------------------------------------------
      PRODUCT META
      ------------------------------------------------------------------------------
      {% endcomment %}

      {%- if section.settings.show_share_buttons -%}
        {%- capture share_buttons -%}
          {%- assign share_url = shop.url | append: product.url -%}
          {%- assign twitter_text = product.title | url_param_escape -%}
          {%- assign pinterest_description = product.description | strip_html | truncatewords: 15 | url_param_escape -%}
          {%- assign pinterest_image = product.featured_media | img_url: '1024x' | prepend: 'https:' -%}

          <ul class="social-media__item-list list--unstyled">
            <li class="social-media__item social-media__item--facebook">
              <a href="https://www.facebook.com/sharer.php?u={{ share_url }}" target="_blank" rel="noopener" aria-label="{{ 'general.social.facebook_share' | t }}">{%- render 'icon', icon: 'facebook' -%}</a>
            </li>

            <li class="social-media__item social-media__item--pinterest">
              <a href="https://pinterest.com/pin/create/button/?url={{ share_url }}{% if pinterest_image != blank %}&media={{ pinterest_image }}{% endif %}&description={{ pinterest_description }}" target="_blank" rel="noopener" aria-label="{{ 'general.social.pinterest_pin' | t }}">{%- render 'icon', icon: 'pinterest' -%}</a>
            </li>

            <li class="social-media__item social-media__item--twitter">
              <a href="https://twitter.com/share?{% if twitter_text != blank %}text={{twitter_text}}&{% endif %}url={{ share_url }}" target="_blank" rel="noopener" aria-label="{{ 'general.social.twitter_tweet' | t }}">{%- render 'icon', icon: 'twitter' -%}</a>
            </li>

            <li class="social-media__item">
              <a href="mailto:?&subject={{ product.title | escape }}&body={{ share_url }}" aria-label="{{ 'general.social.email_share' | t }}">{% render 'icon', icon: 'email' %}</a>
            </li>
          </ul>
        {%- endcapture -%}
      {%- endif -%}

      <div class="product-meta">
        {%- if template.name == 'product' and template != 'product.quick-view' -%}
          <h1 class="product-meta__title heading h1">{{ product.title }}</h1>
        {%- else -%}
          <h3 class="product-meta__title heading h2">
            <a href="{{ product.url }}">{{ product.title }}</a>
          </h3>
        {%- endif -%}

        {%- capture product_labels -%}
          {%- for tag in product.tags -%}
            {%- if tag contains '__label:' -%}
              <span class="product-label product-label--custom1">{{ tag | split: '__label:' | last }}</span>
            {%- endif -%}

            {%- if tag contains '__label1:' -%}
              <span class="product-label product-label--custom1">{{ tag | split: '__label1:' | last }}</span>
            {%- endif -%}

            {%- if tag contains '__label2:' -%}
              <span class="product-label product-label--custom2">{{ tag | split: '__label2:' | last }}</span>
            {%- endif -%}
          {%- endfor -%}

          {%- if settings.show_discount -%}
            {%- assign savings = 0 -%}

            {%- if settings.discount_mode == 'percentage' -%}
              {%- assign savings = selected_variant.compare_at_price | minus: selected_variant.price | times: 100.0 | divided_by: selected_variant.compare_at_price | round | append: '%' -%}
            {%- else -%}
              {%- capture savings -%}<span>{{ selected_variant.compare_at_price | minus: selected_variant.price | money_without_trailing_zeros }}</span>{%- endcapture -%}
            {%- endif -%}

            <span class="product-label product-label--on-sale" {% unless selected_variant.price < selected_variant.compare_at_price %}style="display: none"{% endunless %}>{{ 'collection.product.discount_html' | t: savings: savings }}</span>
          {%- endif -%}
        {%- endcapture -%}

        {%- if product_labels != blank -%}
          <div class="product-meta__label-list d-none">
            {{- product_labels -}}
          </div>
        {%- endif -%}

        {%- if section.settings.show_vendor or section.settings.show_sku and selected_variant.sku != blank -%}
          <div class="product-meta__reference">
            {%- if section.settings.show_vendor -%}
              {%- assign vendor_handle = product.vendor | handle -%}
              {%- assign collection_for_vendor = collections[vendor_handle] -%}

              {%- unless collection_for_vendor.empty? -%}
                <a class="product-meta__vendor link link--accented" href="{{ collection_for_vendor.url }}">{{ product.vendor }}</a>
              {%- else -%}
                <a class="product-meta__vendor link link--accented" href="{{ product.vendor | url_for_vendor }}">{{ product.vendor }}</a>
              {%- endunless -%}
            {%- endif -%}

            {%- if section.settings.show_sku and selected_variant.sku != blank -%}
              <span class="product-meta__sku">
                {{- 'product.general.sku' | t -}} <span class="product-meta__sku-number">{{ selected_variant.sku }}</span>
              </span>
            {%- endif -%}
          </div>
        {%- endif -%}

        {%- if section.settings.show_reviews_badge -%}
          <a href="{% if template.name != 'product' or template == 'product.quick-view' %}{{ product.url | within: collection }}{% endif %}#product-reviews" class="product-meta__reviews-badge link" data-offset="30">
            <span class="shopify-product-reviews-badge" data-id="{{ product.id }}">
              {%- comment -%}Display a placeholder, to allocate space{%- endcomment -%}
              <div class="spr-badge" style="opacity: 0">
                <span class="spr-starrating spr-badge-starrating">
                  <i class="spr-icon spr-icon-star-empty"></i>
                  <i class="spr-icon spr-icon-star-empty"></i>
                  <i class="spr-icon spr-icon-star-empty"></i>
                  <i class="spr-icon spr-icon-star-empty"></i>
                  <i class="spr-icon spr-icon-star-empty"></i>
                </span>

                <span class="spr-badge-caption">filler</span>
              </div>
            </span>
          </a>
        {%- endif -%}

        {%- if section.settings.show_share_buttons -%}
          <div class="product-meta__share-buttons hidden-phone">
            {{ share_buttons }}
          </div>
        {%- endif -%}
      </div>

      <hr class="card__separator">

      {%- if request.page_type == 'index' and section.settings.show_description and product.description != blank and section.settings.description_below_add_to_cart == false -%}
        <div class="product-meta__description rte">
          {{ product.description | remove: 'data-section-type="product"' }}
        </div>
      {%- endif -%}

      {% comment %}
      ------------------------------------------------------------------------------
      PRODUCT FORM
      ------------------------------------------------------------------------------
      {% endcomment %}

      {%- assign color_label = 'color,colour,couleur,cor,colore,farbe,색,色,カラー,färg,farve' | split: ',' -%}

      {%- form 'product', product, class: 'product-form' -%}
        <div class="product-form__price">
          <div class="price-list">
            {%- if selected_variant.compare_at_price > selected_variant.price -%}
              <span class="price price--highlight">{{ selected_variant.price | money_without_trailing_zeros }}</span>
              <span class="price price--compare">{{ selected_variant.compare_at_price | money_without_trailing_zeros }}</span>
            {%- else -%}
              <span class="price">{{ selected_variant.price | money_without_trailing_zeros }}</span>
            {%- endif -%}
          </div>

          {% render 'product-vip-pricing' %}

          <div class="product-form__price-info" style="display: {% if selected_variant.unit_price_measurement %}block{% else %}none{% endif %}">
            <div class="unit-price-measurement">
              <span class="unit-price-measurement__price">{{ selected_variant.unit_price | money_without_trailing_zeros }}</span>
              <span class="unit-price-measurement__separator">/ </span>

              {%- if selected_variant.unit_price_measurement.reference_value != 1 -%}
                <span class="unit-price-measurement__reference-value">{{ selected_variant.unit_price_measurement.reference_value }}</span>
              {%- endif -%}

              <span class="unit-price-measurement__reference-unit">{{ selected_variant.unit_price_measurement.reference_unit }}</span>
            </div>
          </div>

          {%- if section.settings.show_taxes_included -%}
            {%- if shop.taxes_included or shop.shipping_policy.body != blank -%}
              <p class="product-form__price-info">
                {%- if shop.taxes_included -%}
                  {{ 'product.general.include_taxes' | t }}
                {%- endif -%}

                {%- if shop.shipping_policy.body != blank -%}
                  {{ 'product.general.shipping_policy_html' | t: link: shop.shipping_policy.url }}
                {%- endif -%}
              </p>
            {%- endif -%}
          {%- endif -%}
        </div>
        
        {%- unless product.has_only_default_variant -%}
          <div class="product-form__variants">
            {%- for option in product.options_with_values -%}
              {%- assign downcase_option = option.name | downcase -%}
              {%- capture option_name -%}{{ section.id }}-{{ product.id }}-{{ forloop.index }}{%- endcapture -%}

              {%- assign option_selector_type = 'select' -%}

              {%- if section.settings.color_mode != 'block' and section.settings.color_mode != 'dropdown' and color_label contains downcase_option -%}
                {%- comment -%}NOTE: even if the merchant is using the mode to display variant images, if ALL variant do not have an associated image, we fallback to color{%- endcomment -%}

                {%- assign has_image_attached_to_all_variants = true -%}

                {%- for variant in product.variants -%}
                  {%- unless variant.image -%}
                    {%- assign has_image_attached_to_all_variants = false -%}
                    {%- break -%}
                  {%- endunless -%}
                {%- endfor -%}

                {%- if section.settings.color_mode == 'color' or has_image_attached_to_all_variants == false -%}
                  {%- assign option_selector_type = 'color' -%}
                {%- else -%}
                  {%- assign option_selector_type = 'variant' -%}
                {%- endif -%}
              {%- else -%}
                {%- if color_label contains downcase_option -%}
                  {%- if section.settings.color_mode == 'block' -%}
                    {%- assign option_selector_type = 'block' -%}
                  {%- endif -%}
                {%- elsif section.settings.selector_mode == 'block' -%}
                  {%- assign option_selector_type = 'block' -%}
                {%- endif -%}
              {%- endif -%}

              <div class="product-form__option option-{{ option.name | handleize }}" data-selector-type="{{ option_selector_type }}">
                {%- case option_selector_type -%}
                  {%- when 'color' -%}
                    <span class="product-form__option-name text--strong{% if option.values.size <= 1 %} d-none{% endif %}">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

                    <div class="color-swatch-list color-swatch-list--large{% if option.values.size <= 1 %} d-none{% endif %}">
                      {%- for value in option.values -%}
                        {%- assign downcased_value = value | downcase -%}
                        {%- capture color_id -%}{{ option_name }}-{{ forloop.index }}{%- endcapture -%}

                        {%- assign color_swatch_name = value | handle | append: '.png' -%}
                        {%- assign color_swatch_image = images[color_swatch_name] -%}

                        <div class="color-swatch {% if downcased_value == 'white' or downcased_value == 'blanc' %}color-swatch--white{% endif %}">
                          <input class="color-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ color_id }}" value="{{ value | escape }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}" aria-hidden="true">
                          <label class="color-swatch__item lazyload" for="{{ color_id }}" {% if color_swatch_image != blank %}data-bg="{{ color_swatch_image | img_url: '64x64' }}"{% else %}style="background-color: {{ value | replace: ' ', '' | downcase }}"{% endif %} title="{{ value | escape }}">{% render 'icon', icon: 'cross-sold-out' %}</label>
                        </div>
                      {%- endfor -%}
                    </div>
                  {%- when 'variant' -%}
                    <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

                    <div class="variant-swatch-list">
                      {%- capture option_name -%}option{{ option.position }}{%- endcapture -%}

                      {%- for value in option.values -%}
                        {%- capture variant_swatch_id -%}{{ option_name }}-{{ forloop.index }}{%- endcapture -%}

                        {%- for variant in product.variants -%}
                          {%- if variant[option_name] == value and variant.image -%}
                            <div class="variant-swatch">
                              <input class="variant-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ variant_swatch_id }}" value="{{ value | escape }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}">

                              <label class="variant-swatch__item" for="{{ variant_swatch_id }}" title="{{ value | escape }}">
                                <div class="aspect-ratio" style="padding-bottom: {{ 100.0 | divided_by: variant.image.aspect_ratio }}%">
                                  <img src="{{ variant.image | img_url: '120x' }}" alt="{{ variant.image.alt | escape }}">
                                </div>

                                {% render 'icon', icon: 'cross-sold-out' %}
                              </label>
                            </div>

                            {%- break -%}
                          {%- endif -%}
                        {%- endfor -%}
                      {%- endfor -%}
                    </div>
                  {%- when 'block' -%}
                    <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

                    <div class="block-swatch-list">
                      {%- for value in option.values -%}
                        {%- capture block_swatch_id -%}{{ option_name }}-{{ forloop.index }}{%- endcapture -%}
                        {%- capture swatch_svg -%}
                          {%- if option.name == 'Cushion Arrangement' or option.name == 'Arm Style' -%}
                            {%- assign icon_name = value | handleize | prepend: '-' | prepend: option.name | handleize -%}
                            <div class="block-swatch__item-svg">
                              {% render 'icon', icon: icon_name %}
                            </div>
                          {%- endif -%}
                        {%- endcapture -%}

                        <div class="block-swatch">
                          <input class="block-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ block_swatch_id }}" value="{{ value | escape }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}" aria-hidden="true">
                          <label class="block-swatch__item" for="{{ block_swatch_id }}" title="{{ value | escape }}">
                            {%- if swatch_svg -%}
                              {{ swatch_svg }}
                            {%- endif -%}
                            <span class="block-swatch__item-text">{{ value }}</span>
                          </label>
                        </div>
                      {%- endfor -%}
                    </div>
                  {%- when 'select' -%}
                    <label for="{{ option_name }}" class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></label>

                    <div class="select-wrapper select-wrapper--primary">
                      {%- render 'icon', icon: 'arrow-bottom' -%}

                      <select class="product-form__single-selector" name="{{ option_name }}" id="{{ option_name }}" data-option-position="{{ option.position }}">
                        {%- for value in option.values -%}
                          <option value="{{ value | escape }}" {% if value == option.selected_value %}selected="selected"{% endif %}>{{ value }}</option>
                        {%- endfor -%}
                      </select>
                    </div>
                {%- endcase -%}
              </div>
            {%- endfor -%}

            <div class="no-js product-form__option">
              <label for="product-select-{{ product.id }}">{{ 'product.form.variant' | t }}</label>

              <div class="select-wrapper select-wrapper--primary">
                <select id="product-select-{{ product.id }}" name="id">
                  {%- for variant in product.variants -%}
                    <option {% if variant == selected_variant %}selected="selected"{% endif %} {% unless variant.available %}disabled="disabled"{% endunless %} value="{{ variant.id }}" data-sku="{{ variant.sku }}">{{ variant.title }} - {{ variant.price | money }}</option>
                  {%- endfor -%}
                </select>
              </div>
            </div>
          </div>
        {%- else -%}
          <input type="hidden" name="id" data-sku="{{ selected_variant.sku }}" value="{{ selected_variant.id }}">
        {%- endunless -%}

        <div class="product-form__info-list">
  
          {%- if section.settings.show_inventory_quantity and product.template_suffix != 'pre-order' -%}
            <div class="product-form__info-item">
              <span class="product-form__info-title text--strong">{{ 'product.form.inventory' | t }}:</span>

              <div class="product-form__info-content">
                {%- if selected_variant.available -%}
                  {%- if selected_variant.inventory_management and selected_variant.inventory_policy == 'deny' and section.settings.low_inventory_threshold > 0 -%}
                    {%- if selected_variant.inventory_quantity <= section.settings.low_inventory_threshold -%}
                      <span class="product-form__inventory inventory inventory--low">{{ 'product.form.low_stock_with_quantity_count' | t: count: selected_variant.inventory_quantity }}</span>
                    {%- else -%}
                      <span class="product-form__inventory inventory inventory--high">{{ 'product.form.in_stock_with_quantity_count' | t: count: selected_variant.inventory_quantity }}</span>
                    {%- endif -%}
                  {%- else -%}
                    <span class="product-form__inventory inventory inventory--high">{{ 'product.form.in_stock' | t }}</span>
                  {%- endif -%}
                {%- else -%}
                  <span class="product-form__inventory inventory">{{ 'product.form.sold_out' | t }}</span>
                {%- endif -%}

                {%- for tag in product.tags -%}
                  {%- if tag contains '__stock:' -%}
                    {%- assign stock_countdown_max = tag | split: '__stock:' | last | times: 1.0 -%}
                    {%- assign stock_countdown_progress = selected_variant.inventory_quantity | divided_by: stock_countdown_max | times: 100.0 | at_least: 0 | at_most: 100 -%}

                    <span class="inventory-bar {% if stock_countdown_progress == 0 %}inventory-bar--hidden{% endif %}" data-stock-countdown-max="{{ stock_countdown_max }}">
                      <span class="inventory-bar__progress" style="width: 100%"></span>
                    </span>
                    {%- break -%}
                  {%- endif -%}
                {%- endfor -%}
              </div>
            </div>
          {%- endif -%}
        </div>

        <div class="product-form__payment-container">
          {%- if product.template_suffix != 'contact' -%}
            <div class="product-form__add-qty">
              {%- if section.settings.show_quantity_selector -%}
                <div class="product-form__add-qty-input qty-input">
                  <button data-field="quantity" type="button" class="qty-btn qty-dec">-</button>
                  <input min="1" class="form__field" type="number" name="quantity" value="1">
                  <button data-field="quantity" type="button" class="qty-btn qty-inc">+</button>
                </div>
              {%- else -%}
                <input type="hidden" name="quantity" value="1">
              {%- endif -%}

              <div class="product-form__add-qty-btn">
                {%- if selected_variant.available -%}
                  {%- if product.template_suffix == 'pre-order' -%}
                    <button type="submit" class="product-form__add-button button button--primary" data-action="add-to-cart">
                      {{ 'product.form.pre_order' | t }} • <span class="atc-price">{{ selected_variant.price | money_without_trailing_zeros }}</span>
                    </button>
                  {%- else -%}
                    <button type="submit" class="product-form__add-button button button--primary" data-action="add-to-cart">
                      {{ 'product.form.add_to_cart' | t }} • <span class="atc-price">{{ selected_variant.price | money_without_trailing_zeros }}</span>
                    </button>
                  {%- endif -%}
                {%- else -%}
                  <button type="submit" class="product-form__add-button button button--disabled" disabled>
                    {{ 'product.form.sold_out' | t }} • <span class="atc-price">{{ selected_variant.price | money_without_trailing_zeros }}</span>
                  </button>
                {%- endif -%}
              </div>
            </div>

            {%- if section.settings.show_payment_button -%}
              {{ form | payment_button }}
            {%- endif -%}
          {%- else -%}
            <a href="mailto:{{ shop.email }}" class="button button--primary">{{ 'product.form.contact_us' | t }}</a>
          {%- endif -%}
        </div>
      {%- endform -%}

      {%- if request.page_type == 'index' and section.settings.show_description and product.description != blank and section.settings.description_below_add_to_cart -%}
        <div class="product-meta__description rte">
          {{ product.description }}
        </div>
      {%- endif -%}

      {%- if section.settings.show_share_buttons -%}
        <div class="product-meta__share-buttons hidden-tablet-and-up">
          <span class="text--strong">{{ 'product.general.share' | t }}</span>
          {{ share_buttons }}
        </div>
      {%- endif -%}
    </div>

    {%- if section.settings.show_payment_button and product.selected_or_first_available_variant.available == false -%}
      <style>
        #shopify-section-{{ section.id }} .shopify-payment-button {
          display: none;
        }
      </style>
    {%- endif -%}

    {% comment %}
    ------------------------------------------------------------------------------
    Product Data. This must be outputted for all products (including home page).

    IMPORTANT: THIS CODE IS VITAL. DO NOT EDIT IT NOT REMOVE IT. MAKE SURE TO KEEP
    THE EXACT SAME ATTRIBUTES.
    ------------------------------------------------------------------------------
    {% endcomment %}

    <script type="application/json" data-product-json>
      {
        "product": {{ product | json }},
        "options_with_values": {{ product.options_with_values | json }},
        "selected_variant_id": {{ selected_variant.id }}
        {%- if section.settings.show_inventory_quantity -%}
          ,"inventories": {
            {%- for variant in product.variants -%}
              {%- if variant.available -%}
                {%- if variant.inventory_management and variant.inventory_policy == 'deny' and section.settings.low_inventory_threshold > 0 -%}
                  {%- if variant.inventory_quantity <= section.settings.low_inventory_threshold -%}
                    {%- capture inventory_message -%}{{ 'product.form.low_stock_with_quantity_count' | t: count: variant.inventory_quantity }}{%- endcapture -%}
                  {%- else -%}
                    {%- capture inventory_message -%}{{ 'product.form.in_stock_with_quantity_count' | t: count: variant.inventory_quantity }}{%- endcapture -%}
                  {%- endif -%}
                {%- else -%}
                  {%- capture inventory_message -%}{{ 'product.form.in_stock' | t }}{%- endcapture -%}
                {%- endif -%}
              {%- else -%}
                {%- capture inventory_message -%}{{ 'product.form.sold_out' | t }}{%- endcapture -%}
              {%- endif -%}

              "{{ variant.id }}": {
                "inventory_management": {{ variant.inventory_management | json }},
                "inventory_policy": {{ variant.inventory_policy | json }},
                "inventory_quantity": {{ variant.inventory_quantity | json }},
                "inventory_message": {{ inventory_message | json }}
              }{% unless forloop.last %},{% endunless %}
            {%- endfor -%}
          }
        {%- endif -%}
      }
    </script>

    <div class="product-accordeon card__section">
      {%- if section.blocks.size > 0 -%}
        <div class="pdp-offer">
          {%- for block in section.blocks -%}
            <div class="pdp-offer--cell">
              <img src="{{ block.settings.image | img_url: 'x30' }}" alt="{{ block.settings.text | strip_html }}">
              <div class="pdp-offer--cell-text">
                {{ block.settings.text }}
              </div>
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}

      {%- if product.description != blank -%}
        <div class="product-block-list__item product-block-list__item--description product-accordeon--item">
          <div class="card">
            {%- if section.settings.content_display_mode == 'collapse_all' -%}
              <button class="card__collapsible-button" data-action="toggle-collapsible" aria-expanded="true" aria-controls="product-description">
                <span class="card__title heading h6">{{ 'product.general.description' | t }}</span>
                <span class="plus-button plus-button--large"></span>
              </button>

              <div id="product-description" class="card__collapsible" style="height: auto;">
                <div class="card__collapsible-content">
                  <div class="rte">
                    {{ product.description | remove: 'data-section-type="product"' }}
                  </div>
                </div>
              </div>
            {%- else -%}
              <div class="card__header">
                <h2 class="card__title heading h6">{{ 'product.general.description' | t }}</h2>test
              </div>

              {%- if section.settings.content_display_mode == 'show_all_and_expand_description' -%}
                <div class="card__section">
                  <div class="rte">
                    {{ product.description | remove: 'data-section-type="product"' }}
                  </div>
                </div>
              {%- else -%}
                <div class="card__section expandable-content" aria-expanded="false">
                  <div class="rte">
                    {{ product.description | remove: 'data-section-type="product"' }}
                  </div>

                  <button class="expandable-content__toggle">
                    <span class="expandable-content__toggle-icon"></span>
                    <span class="expandable-content__toggle-text" data-view-more="{{ 'product.general.view_more' | t | escape }}" data-view-less="{{ 'product.general.view_less' | t | escape }}">{{- 'product.general.view_more' | t -}}</span>
                  </button>
                </div>
              {%- endif -%}
            {%- endif -%}
          </div>
        </div>
      {%- endif -%}

      {%- if product.metafields.pdp.care != blank -%}
        <div class="product-block-list__item product-block-list__item--description product-accordeon--item">
          <div class="card">
            {%- if section.settings.content_display_mode == 'collapse_all' -%}
              <button class="card__collapsible-button" data-action="toggle-collapsible" aria-expanded="false" aria-controls="product-description">
                <span class="card__title heading h6">Care</span>
                <span class="plus-button plus-button--large"></span>
              </button>

              <div id="product-description" class="card__collapsible">
                <div class="card__collapsible-content">
                  <div class="rte">
                    {{ product.metafields.pdp.care }}
                  </div>
                </div>
              </div>
            {%- else -%}
              <div class="card__header">
                <h2 class="card__title heading h6">Care</h2>
              </div>

              {%- if section.settings.content_display_mode == 'show_all_and_expand_description' -%}
                <div class="card__section">
                  <div class="rte">
                    {{ product.metafields.pdp.care }}
                  </div>
                </div>
              {%- else -%}
                <div class="card__section expandable-content" aria-expanded="false">
                  <div class="rte">
                    {{ product.metafields.pdp.care }}
                  </div>

                  <button class="expandable-content__toggle">
                    <span class="expandable-content__toggle-icon"></span>
                    <span class="expandable-content__toggle-text" data-view-more="{{ 'product.general.view_more' | t | escape }}" data-view-less="{{ 'product.general.view_less' | t | escape }}">{{- 'product.general.view_more' | t -}}</span>
                  </button>
                </div>
              {%- endif -%}
            {%- endif -%}
          </div>
        </div>
      {%- endif -%}

      {%- comment -%}
      --------------------------------------------------------------------------------------
      TABS
      --------------------------------------------------------------------------------------
      {%- endcomment -%}

      {%- for i in (1..5) -%}
        {%- assign unique_tab_title = '' -%}
        {%- assign unique_tab_content = '' -%}

        {%- comment -%}First check for metafields{%- endcomment -%}

        {%- assign metafield_tab_title_option = 'tab_' | append: i | append: '_title' -%}
        {%- assign metafield_tab_content_option = 'tab_' | append: i | append: '_content' -%}

        {%- if product.metafields.sf_product_tabs[metafield_tab_title_option] != blank and product.metafields.sf_product_tabs[metafield_tab_content_option] != blank -%}
          {%- assign unique_tab_title = product.metafields.sf_product_tabs[metafield_tab_title_option] -%}
          {%- assign unique_tab_content = product.metafields.sf_product_tabs[metafield_tab_content_option] -%}
        {%- else -%}
          {%- assign tab_to_look = '__tab' | append: i | append: ':' -%}

          {%- for tag in product.tags -%}
            {%- if tag contains tab_to_look -%}
              {%- assign unique_tab_handle = tag | split: tab_to_look | last -%}
              {%- assign unique_tab_page = pages[unique_tab_handle] -%}

              {%- unless unique_tab_page.empty? -%}
                {%- assign unique_tab_title = unique_tab_page.title -%}
                {%- assign unique_tab_content = unique_tab_page.content -%}
                {%- break -%}
              {%- endunless -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}

        {%- if unique_tab_title != blank and unique_tab_content != blank -%}
          <div class="product-block-list__item product-block-list__item--content product-accordeon--item">
            <div class="card">
              {%- if section.settings.content_display_mode == 'collapse_all_except_description' or section.settings.content_display_mode == 'collapse_all' -%}
                <button class="card__collapsible-button" data-action="toggle-collapsible" aria-expanded="false" aria-controls="unique-tab-{{ i }}">
                  <span class="card__title heading h6">{{ unique_tab_title }}</span>
                  <span class="plus-button plus-button--large"></span>
                </button>

                <div id="unique-tab-{{ i }}" class="card__collapsible">
                  <div class="card__collapsible-content">
                    <div class="rte">
                      {{ unique_tab_content }}
                    </div>
                  </div>
                </div>
              {%- else -%}
                <div class="card__header">
                  <h2 class="card__title heading h6">{{ unique_tab_title }}</h2>
                </div>

                <div class="card__section expandable-content" aria-expanded="false">
                  <div class="rte">
                    {{ unique_tab_content }}
                  </div>

                  <button class="expandable-content__toggle">
                    <span class="expandable-content__toggle-icon"></span>
                    <span class="expandable-content__toggle-text" data-view-more="{{ 'product.general.view_more' | t | escape }}" data-view-less="{{ 'product.general.view_less' | t | escape }}">{{- 'product.general.view_more' | t -}}</span>
                  </button>
                </div>
              {%- endif -%}
            </div>
          </div>
        {%- endif -%}
      {%- endfor -%}

      {%- for i in (1..3) -%}
        {%- assign global_tab_option = 'tab_page_' | append: i | append: '_handle' -%}
        {%- assign global_tab_page = pages[section.settings[global_tab_option]] -%}

        {%- unless global_tab_page.empty? -%}
          <div class="product-block-list__item product-block-list__item--content product-accordeon--item">
            <div class="card">
              {%- if section.settings.content_display_mode == 'collapse_all_except_description' or section.settings.content_display_mode == 'collapse_all' -%}
                <button class="card__collapsible-button" data-action="toggle-collapsible" aria-expanded="false" aria-controls="global-tab-{{ i }}">
                  <span class="card__title heading h6">{{ global_tab_page.title }}</span>
                  <span class="plus-button plus-button--large"></span>
                </button>

                <div id="global-tab-{{ i }}" class="card__collapsible">
                  <div class="card__collapsible-content">
                    <div class="rte">
                      {{ global_tab_page.content }}
                    </div>
                  </div>
                </div>
              {%- else -%}
                <div class="card__header">
                  <h2 class="card__title heading h6">{{ global_tab_page.title }}</h2>
                </div>

                <div class="card__section expandable-content" aria-expanded="false">
                  <div class="rte">
                    {{ global_tab_page.content }}
                  </div>

                  <button class="expandable-content__toggle">
                    <span class="expandable-content__toggle-icon"></span>
                    <span class="expandable-content__toggle-text" data-view-more="{{ 'product.general.view_more' | t | escape }}" data-view-less="{{ 'product.general.view_less' | t | escape }}">{{- 'product.general.view_more' | t -}}</span>
                  </button>
                </div>
              {%- endif -%}
            </div>
          </div>
        {%- endunless -%}
      {%- endfor -%}
    </div>

    {%- comment -%}
    --------------------------------------------------------------------------------------
    REVIEWS
    --------------------------------------------------------------------------------------
    {%- endcomment -%}

    {%- if section.settings.enable_reviews -%}
      <div class="product-block-list__item product-block-list__item--reviews">
        <span id="product-reviews" class="anchor"></span>

        <div class="card">
          <div class="card__section">
            {%- assign reviews_count = product.metafields.spr.reviews | split: '<meta itemprop="reviewCount" content="' | last | split: '">' | first | times: 1 -%}
            <div id="shopify-product-reviews" class="spr-reviews {% if reviews_count > 0 %}spr-reviews--has-reviews{% endif %}" data-id="{{ product.id }}">{{ product.metafields.spr.reviews }}</div>
          </div>
        </div>
      </div>
    {%- endif -%}

    {%- comment -%}
    --------------------------------------------------------------------------------------
    SECURITY BADGES
    --------------------------------------------------------------------------------------
    {%- endcomment -%}

    {%- if section.settings.show_payment_icons and shop.enabled_payment_types.size > 0 -%}
      {%- assign show_payment_icons = true -%}
    {%- else -%}
      {%- assign show_payment_icons = false -%}
    {%- endif -%}

    {%- if section.settings.custom_security_badge or show_payment_icons -%}
      <div class="product-block-list__item product-block-list__item--trust">
        <div class="card">
          <div class="card__header card__header--flex">
            <h2 class="card__title heading h6">{{ section.settings.trust_title | escape }}</h2>

            {%- render 'icon', icon: 'lock', width: 22, height: 24 -%}
          </div>

          <div class="card__section">
            {%- if show_payment_icons -%}
              {%- if section.settings.custom_security_badge -%}
                <p class="card__subtitle heading h6">{{ 'product.general.payment' | t }}</p>
              {%- endif -%}

              <div class="payment-list">
                {% for type in shop.enabled_payment_types %}
                  {{ type | payment_type_svg_tag: class: 'payment-list__item' }}
                {% endfor %}
              </div>

              <p class="payment-list__notice">{{ 'product.general.payment_notice' | t }}</p>
            {%- endif -%}

            {%- if show_payment_icons and section.settings.custom_security_badge -%}
              <hr class="card__separator">
            {%- endif -%}

            {%- if section.settings.custom_security_badge -%}
              {%- if show_payment_icons -%}
                <p class="card__subtitle heading h6">{{ 'product.general.security' | t }}</p>
              {%- endif -%}

              {%- assign badge_width = section.settings.custom_security_badge.width | at_most: 450 | append: 'x' -%}
              <img class="product__trust-badge" src="{{ section.settings.custom_security_badge | img_url: badge_width }}" srcset="{{ section.settings.custom_security_badge | img_url: badge_width }} 1x, {{ section.settings.custom_security_badge | img_url: badge_width, scale: 2 }} 2x" alt="{{ section.settings.custom_security_badge.alt | escape }}">
            {%- endif -%}
          </div>
        </div>
      </div>
    {%- endif -%}

    {%- comment -%}
    --------------------------------------------------------------------------------------
    ESTIMATE SHIPPING
    --------------------------------------------------------------------------------------
    {%- endcomment -%}

    {%- if section.settings.show_shipping_estimator and product.available -%}
      <div class="product-block-list__item product-block-list__item--shipping">
        <div class="card">
          <div class="card__header">
            <h2 class="card__title heading h6">{{ 'product.general.estimate_shipping' | t }}</h2>
          </div>

          <div class="card__section">
            <div class="shipping-estimator form">
              <div class="form__input-row">
                <div class="form__input-wrapper">
                  <label for="shipping-estimator-country" class="form__label">{{ 'cart.shipping_estimator.country' | t }}</label>

                  <div class="select-wrapper select-wrapper--primary">
                    {%- render 'icon', icon: 'arrow-bottom' -%}

                    <select name="country" id="shipping-estimator-country" data-default="{{ customer.default_address.country | default: section.settings.shipping_estimator_default_country }}" required>
                      {{- country_option_tags -}}
                    </select>
                  </div>
                </div>

                <div class="form__input-wrapper" style="display: none">
                  <label for="shipping-estimator-province" class="form__label">{{ 'cart.shipping_estimator.province' | t }}</label>

                  <div class="select-wrapper select-wrapper--primary">
                    {%- render 'icon', icon: 'arrow-bottom' -%}

                    <select name="province" id="shipping-estimator-province" data-default="{{ customer.default_address.province }}"></select>
                  </div>
                </div>

                <div class="form__input-wrapper" style="max-width: 155px">
                  <label for="shipping-estimator-zip" class="form__label">{{ 'cart.shipping_estimator.zip_code' | t }}</label>
                  <input type="text" name="zip" id="shipping-estimator-zip" class="form__field form__field--text" value="{{ customer.default.address.zip }}" required>
                </div>
              </div>

              <button type="button" class="form__submit button button--primary" data-action="estimate-shipping">{{ 'cart.shipping_estimator.estimate' | t }}</button>

              <div class="shipping-estimator__results rte" style="display: none;"></div>
            </div>
          </div>

          {%- if section.settings.show_refunds_policy and shop.refund_policy != blank -%}
            <div class="card__section card__section--tight">
              <button class="product__refund-policy-link link link--accented" data-action="open-modal" aria-controls="modal-refunds-policy">{{ 'product.general.refund_policy' | t }} {%- render 'icon', icon: 'arrow-right' -%}</button>
            </div>
          {%- endif -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</div>